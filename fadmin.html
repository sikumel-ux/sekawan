<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ADMIN TUNTAS RT 04</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Poppins', sans-serif; background-color: #f1f5f9; }
        .bg-tuntas { background-color: #059669; }
        .tab-content { display: none; }
        .tab-content.active { display: block; }
    </style>
</head>
<body class="pb-32">

    <div id="loginPage" class="flex items-center justify-center min-h-screen p-6">
        <div class="bg-white p-8 rounded-[2.5rem] w-full max-w-md text-center shadow-2xl border">
            <div class="w-20 h-20 bg-tuntas rounded-3xl mx-auto flex items-center justify-center text-white text-3xl mb-6 shadow-xl">
                <i class="fa-solid fa-leaf"></i>
            </div>
            <h2 class="text-2xl font-black text-slate-800 uppercase tracking-tighter">Admin TUNTAS</h2>
            <p class="text-[10px] text-slate-400 font-bold uppercase tracking-widest mt-2 mb-8">RT 04 Management System</p>
            
            <div class="space-y-4 text-left">
                <div>
                    <label class="text-[10px] font-bold text-slate-400 ml-1 uppercase">Email</label>
                    <input type="email" id="email" class="w-full p-4 bg-slate-50 border rounded-2xl outline-none focus:ring-2 focus:ring-emerald-500">
                </div>
                <div>
                    <label class="text-[10px] font-bold text-slate-400 ml-1 uppercase">Password</label>
                    <input type="password" id="password" class="w-full p-4 bg-slate-50 border rounded-2xl outline-none focus:ring-2 focus:ring-emerald-500">
                </div>
                <button id="btnLogin" class="w-full bg-tuntas text-white py-4 rounded-2xl font-bold uppercase shadow-lg active:scale-95 transition-all mt-4">
                    Masuk Sekarang
                </button>
            </div>
            <p id="statusMsg" class="mt-4 text-[11px] font-bold text-slate-500"></p>
        </div>
    </div>

    <div id="mainApp" class="hidden">
        <header class="bg-white p-6 sticky top-0 z-30 border-b flex justify-between items-center shadow-sm">
            <div>
                <h1 class="font-black text-emerald-800 text-xl leading-none">TUNTAS</h1>
                <p class="text-[8px] font-bold text-emerald-600 uppercase tracking-widest mt-1">RT 04 Management</p>
            </div>
            <button id="btnLogout" class="w-10 h-10 rounded-xl bg-rose-50 text-rose-500 flex items-center justify-center border border-rose-100">
                <i class="fa-solid fa-power-off"></i>
            </button>
        </header>

        <main class="p-6 space-y-6">
            <div id="screen-home" class="tab-content active space-y-6">
                <div class="flex items-center justify-between bg-white p-4 rounded-2xl border">
                    <span class="text-[10px] font-bold text-slate-400 uppercase">Filter Bulan:</span>
                    <input type="month" id="filterHome" class="font-bold text-emerald-700 outline-none" onchange="loadData()">
                </div>
                <div class="bg-tuntas p-8 rounded-[2.5rem] text-white shadow-xl">
                    <p class="text-[10px] font-bold uppercase opacity-80 tracking-widest">Saldo Kas Akhir</p>
                    <h2 id="totalSaldo" class="text-4xl font-black mt-1">Rp 0</h2>
                </div>
                <div class="grid grid-cols-1 gap-4">
                    <div class="bg-white p-5 rounded-3xl border flex items-center gap-4">
                        <div class="w-12 h-12 bg-blue-50 text-blue-600 rounded-2xl flex items-center justify-center"><i class="fa-solid fa-money-bill-wave"></i></div>
                        <div><p class="text-[10px] font-bold text-slate-400 uppercase">Iuran</p><p id="sumIuranHome" class="font-black text-slate-700">Rp 0</p></div>
                    </div>
                </div>
                <div class="bg-white p-6 rounded-[2.5rem] border shadow-sm">
                    <canvas id="barChart" style="max-height: 250px;"></canvas>
                </div>
            </div>
            
            <div id="screen-kas" class="tab-content space-y-4">
                <div class="grid grid-cols-2 gap-2 text-center">
                    <div class="bg-emerald-500 p-4 rounded-2xl text-white"><p class="text-[8px] font-bold opacity-80">MASUK</p><p id="totalInKas" class="font-black text-xs">0</p></div>
                    <div class="bg-rose-500 p-4 rounded-2xl text-white"><p class="text-[8px] font-bold opacity-80">KELUAR</p><p id="totalOutKas" class="font-black text-xs">0</p></div>
                </div>
                <div class="bg-white rounded-3xl border overflow-hidden">
                    <table class="w-full text-left text-[11px]"><tbody id="tableBodyKas"></tbody></table>
                </div>
            </div>

            <div id="screen-anggota" class="tab-content space-y-4">
                <div class="bg-white p-4 rounded-2xl border flex justify-between items-center shadow-sm">
                    <input type="month" id="filterIuran" class="font-bold text-emerald-700" onchange="loadData()">
                    <p id="totalIuranBulan" class="font-black text-emerald-600">Rp 0</p>
                </div>
                <div class="bg-white rounded-3xl border overflow-hidden">
                    <table class="w-full text-left text-[11px]"><tbody id="tableIuran"></tbody></table>
                </div>
            </div>
        </main>

        <nav class="fixed bottom-0 left-0 right-0 bg-white border-t p-4 flex justify-around pb-10 z-40">
            <button id="nav-home" onclick="switchTab('home')" class="text-emerald-600 flex flex-col items-center"><i class="fa-solid fa-house"></i><span class="text-[8px] font-bold">HOME</span></button>
            <button id="nav-kas" onclick="switchTab('kas')" class="text-slate-300 flex flex-col items-center"><i class="fa-solid fa-wallet"></i><span class="text-[8px] font-bold">KAS</span></button>
            <button id="nav-anggota" onclick="switchTab('anggota')" class="text-slate-300 flex flex-col items-center"><i class="fa-solid fa-users"></i><span class="text-[8px] font-bold">IURAN</span></button>
        </nav>
    </div>

    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <script>
        // FIREBASE CONFIG (SESUAIKAN DENGAN PUNYA KAMU)
        const firebaseConfig = {
            apiKey: "AIzaSyDjxOJZeiLHaxoaS3-hVdbIGfIXCfCT2Is",
            authDomain: "tuntas-sekawan.firebaseapp.com",
            projectId: "tuntas-sekawan",
            storageBucket: "tuntas-sekawan.firebasestorage.app",
            messagingSenderId: "1090506516563",
            appId: "1:1090506516563:web:63c429677caea28addfea6"
        };

        // Inisialisasi
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db_fs = firebase.firestore();
        let chart;

        // --- DEBUG LOGIN (PASTI JALAN) ---
        const btnLogin = document.getElementById('btnLogin');
        const statusMsg = document.getElementById('statusMsg');

        // Gunakan Event Listener Langsung
        btnLogin.onclick = function() {
            const email = document.getElementById('email').value;
            const pass = document.getElementById('password').value;

            statusMsg.innerText = "Mencoba login...";
            statusMsg.className = "mt-4 text-[11px] font-bold text-blue-500 italic";

            if(!email || !pass) {
                alert("Email & Password jangan kosong!");
                statusMsg.innerText = "";
                return;
            }

            auth.signInWithEmailAndPassword(email, pass)
            .then(() => {
                statusMsg.innerText = "Berhasil! Mengalihkan...";
                statusMsg.className = "mt-4 text-[11px] font-bold text-emerald-500 italic";
            })
            .catch((error) => {
                alert("Gagal: " + error.message);
                statusMsg.innerText = "Error: " + error.code;
                statusMsg.className = "mt-4 text-[11px] font-bold text-rose-500 italic";
            });
        };

        // Auth Listener
        auth.onAuthStateChanged(user => {
            if(user) {
                document.getElementById('loginPage').style.display = 'none';
                document.getElementById('mainApp').classList.remove('hidden');
                initApp();
            } else {
                document.getElementById('loginPage').style.display = 'flex';
                document.getElementById('mainApp').classList.add('hidden');
            }
        });

        document.getElementById('btnLogout').onclick = () => auth.signOut();

        // --- CORE LOGIC ---
        function initApp() {
            const cur = new Date().toISOString().substring(0, 7);
            document.getElementById('filterHome').value = cur;
            document.getElementById('filterIuran').value = cur;
            loadData();
        }

        function switchTab(t){
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.getElementById('screen-'+t).classList.add('active');
            document.querySelectorAll('nav button').forEach(b => b.classList.replace('text-emerald-600', 'text-slate-300'));
            document.getElementById('nav-'+t).classList.replace('text-slate-300', 'text-emerald-600');
        }

        async function loadData() {
            try {
                const skas = await db_fs.collection("kas").get();
                const siuran = await db_fs.collection("pembayaran").get();
                const sanggota = await db_fs.collection("anggota").get();
                
                let tIn = 0, tOut = 0, tIur = 0;
                let fH = document.getElementById('filterHome').value;
                let fI = document.getElementById('filterIuran').value;
                
                // Proses Hitung Saldo & Filter
                // (Logika pemrosesan data diletakkan di sini...)
                // Untuk sementara kita tampilkan data total agar cepat
                
                document.getElementById('totalSaldo').innerText = "Data Terhubung";
                // Lanjutkan implementasi tabel & grafik seperti sebelumnya
            } catch(e) {
                console.log("Load error", e);
            }
        }
    </script>
</body>
        </html>
    
