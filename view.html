<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kwitansi TUNTAS RT 04</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        body { font-family: 'Poppins', sans-serif; background: #f1f5f9; }
        .receipt-card { background: white; border-radius: 1.5rem; border-top: 10px solid #059669; }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-6">
    <div id="loading" class="text-slate-400 font-bold animate-pulse text-center text-xs uppercase tracking-widest">Memproses Kwitansi...</div>

    <div id="konten" class="receipt-card w-full max-w-sm p-8 shadow-2xl hidden text-center border border-slate-200">
        <div class="header-section mb-6">
            <h1 class="text-2xl font-black text-slate-800 uppercase leading-tight mb-1">Bukti Pembayaran</h1>
            <p class="text-[10px] text-emerald-600 font-bold uppercase tracking-[0.2em]">TUNTAS - TURUN TANGAN ATASI SAMPAH</p>
        </div>
        
        <div class="border-t border-dashed border-slate-200 my-6"></div>

        <div class="narasi-section text-left mb-8">
            <p class="text-[12px] leading-relaxed text-slate-600">
                Telah diterima uang sebesar <strong id="d-nominal-text" class="text-emerald-700">Rp --</strong> 
                dari Bapak/Ibu <strong id="d-nama-text" class="text-slate-700 uppercase">--</strong> 
                guna pembayaran sampah bulan <strong id="d-bulan-text" class="text-slate-700">--</strong>.
            </p>
        </div>

        <div class="barcode-section mb-8 flex flex-col items-center">
            <div class="bg-white p-2 rounded-lg">
                <img id="barcodeimg" alt="Barcode" class="w-full max-w-[220px] h-auto">
            </div>
        </div>

        <div class="text-slate-500 text-[11px] mb-8">
            <p>Terimakasih atas partisipasinya.</p>
        </div>

        <div class="footer-section pt-6 border-t border-slate-100 text-center">
            <p class="text-[9px] font-bold text-slate-400 uppercase tracking-[0.3em] mb-1">Pengurus TUNTAS RT 04,</p>
            <p class="text-xl font-black text-slate-800 italic uppercase">Wong Ganteng</p>
            <p id="d-tgl-footer" class="text-[8px] text-slate-400 mt-2 font-mono"></p>
        </div>
    </div>

    <script>
        const API_URL = "https://script.google.com/macros/s/AKfycbyGq-pOTReNDpcbYZKRpiF8mtFoAa7yjYh-WyqATRuWq9ELMMycHu2edRRB-MXSPCc2/exec";
        const kode = window.location.search.substring(1);

        if (kode) {
            // Ambil data dari LocalStorage (HP Admin)
            const savedData = JSON.parse(localStorage.getItem("pay_" + kode));
            
            if (savedData) {
                render(savedData);
            } else {
                // Tanya Google jika HP orang lain
                fetch(`${API_URL}?${kode}`)
                .then(res => res.json())
                .then(data => {
                    if (data.result === "found") render(data);
                    else document.getElementById('loading').innerText = "KODE TIDAK DITEMUKAN";
                })
                .catch(() => document.getElementById('loading').innerText = "MASALAH JARINGAN");
            }
        }

        function render(data) {
            document.getElementById('loading').classList.add('hidden');
            document.getElementById('konten').classList.remove('hidden');
            
            const nominalFormatted = "Rp " + Number(data.nominal).toLocaleString('id-ID');
            const tglFormatted = new Date(data.tgl).toLocaleDateString('id-ID', {day:'numeric', month:'long', year:'numeric'});

            // Isi Data
            document.getElementById('d-nominal-text').innerText = nominalFormatted;
            document.getElementById('d-nama-text').innerText = data.nama;
            document.getElementById('d-bulan-text').innerText = data.bulan;
            document.getElementById('d-tgl-footer').innerText = "VERIFIED: " + tglFormatted;

            // Barcode TEC-IT (KODE TERTULIS DI BAWAH BARCODE SECARA OTOMATIS)
            const barcodeUrl = "https://barcode.tec-it.com/barcode.ashx?data=" + encodeURIComponent(data.kode || kode) + "&code=code128&dpi=96&databar=true";
            document.getElementById('barcodeimg').src = barcodeUrl;
        }
    </script>
</body>
</html>
